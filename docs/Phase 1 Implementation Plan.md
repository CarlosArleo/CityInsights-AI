# Design Document: Phase 1 Implementation Plan (MVP)

This document outlines the features and technical plan required to complete Phase 1 (Minimum Viable Product) of the Democratic Masterplanning AI Platform, as described in the project's vision document (`AI for Democratic Urban Masterplanning.txt`).

## 1. Vision for Phase 1: The Core Analytical Engine

The goal of Phase 1 is to build and validate the absolute core of the application. This phase focuses exclusively on proving that the platform can successfully ingest unstructured text documents, use an AI guided by the framework's ontology to perform a meaningful qualitative analysis, and provide a robust interface for a human expert to curate the results. This creates the foundational layer of validated, structured data upon which all other features will be built.

The two core modules to be developed are:
1.  **The Qualitative Data Engine (QDE):** A backend service that automates the coding and thematic analysis of documents.
2.  **The Human-in-the-Loop (HITL) Interface:** A user-facing UI to review, accept, reject, or modify the AI's suggestions.

---

## 2. Module 1: The Qualitative Data Engine (QDE)

This module is the heart of the application's intelligence, performing deep qualitative analysis on uploaded documents.

### 2.1. User Story & Workflow

1.  From the project dashboard, the user creates a new project.
2.  On the project page, the user uploads a document (PDF, TXT).
3.  An AI flow is triggered automatically in the background. It reads the document and, guided by the framework's principles, identifies key excerpts and categorizes them (e.g., as "Power Dynamics," "Perceptions").
4.  For each identified excerpt, the AI creates a "review card" record in the database, containing the excerpt, the suggested insight/tag, and a link back to the source file.

### 2.2. Backend & AI Flow Implementation

*   **Create the core AI Flow: `src/ai/flows/analyze-document.ts`**
    *   **Input:** `documentDataUri`, `documentType`.
    *   **Logic:**
        1.  Use Google's Gemini model with its large context window to process the entire document at once.
        2.  The prompt will instruct the AI to act as an expert urban analyst and to find excerpts matching the ontology defined in the framework (SocioSpatialPhenomena, DisparateImpact, etc.).
        3.  The prompt will require the AI to output a structured array of objects, where each object contains the `insight` and the verbatim `excerpt`.
    *   **Output:** A structured object containing an array of `keyInsights`.

### 2.3. Firestore Data Model

*   **`projects` collection:**
    *   Each document represents a project, containing fields like `name`, `description`, `ownerId`, and `createdAt`.
*   **`files` sub-collection:**
    *   Nested under each project, a document is created for each uploaded file, storing metadata like `name`, `type`, `url`, `storagePath`, and `status`. This acts as an index for the files in Cloud Storage.
*   **`reviews` sub-collection:**
    *   Nested under each project, a document is created for each insight generated by the `analyzeDocument` flow. It will contain fields like `fileId`, `fileName`, `excerpt`, `insight`, and `status` (defaulting to 'pending').

---

## 3. Module 2: The Human-in-the-Loop (HITL) Interface

This module is the critical user-facing component for ensuring analytical rigor and ethical oversight.

### 3.1. User Story & Workflow

1.  After a document has been processed, a list of "Pending Reviews" appears in the UI.
2.  The user can see each AI-generated insight and the source excerpt it came from.
3.  For each review card, the user has buttons to **"Accept"** or **"Reject"** the AI's finding.
4.  Clicking a button updates the `status` of the corresponding document in the `reviews` sub-collection in Firestore from 'pending' to 'accepted' or 'rejected'.
5.  Accepted insights become part of the project's validated knowledge base, ready to be used as context for more advanced analysis in later phases.

### 3.2. Frontend UI/UX Implementation

*   **Create `src/components/project/QualitativeAnalysis.tsx`:**
    *   This component will fetch and display all review cards from Firestore that have a `status` of 'pending'.
    *   It will render a list of `ReviewCard` components.
*   **Create `src/components/project/ReviewCard.tsx`:**
    *   This component displays the `excerpt` and `insight` for a single review.
    *   It contains the "Accept" and "Reject" buttons, which trigger the Firestore update operations.
*   **Create `src/components/project/DataManagement.tsx`:**
    *   This component will handle the file upload UI and list the processed documents and their status.
