rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // Projects can be read or written only by their owner.
    match /projects/{projectId} {
      allow read, write: if request.auth != null && request.auth.uid == resource.data.ownerId;

      // This rule secures the sub-collection of files for a specific project.
      match /files/{fileId} {
        allow read, write: if request.auth != null && request.auth.uid == resource.data.ownerId;
      }

      // This rule secures the sub-collection of reviews for a specific project.
      match /reviews/{reviewId} {
        allow read, write: if request.auth != null && request.auth.uid == resource.data.ownerId;
      }
    }
    
    // This collection group rule allows cross-project queries (e.g. by an admin)
    // but still ensures that the user is the owner of the document.
    match /{path=**}/reviews/{reviewId} {
       allow read, write: if request.auth != null && request.auth.uid == resource.data.ownerId;
    }
  }
}
